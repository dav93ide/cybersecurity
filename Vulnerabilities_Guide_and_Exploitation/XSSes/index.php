<?php
	include('db_functions.php');

?>
<html>
	<head>
		<title>
			XSS
		</title>
	</head>
	<body style="background-color:black;">
		<?php
			initTable();
			if(isset($_REQUEST['addMex'])){
				insertMessage($_REQUEST['name'], $_REQUEST['message']);
			}
		?>
		<div style="position:absolute; right: 30%; left:30%; top:5%; bottom:75%; background-color:yellow; border-radius:50px; border:5px solid #0F0;text-align:center;">
			<form method="GET">
				<br/> <br/>
				<input type="text" name="name" placeholder="Nome Utente" />
				<input type="text" name="message" placeholder="Corpo Messaggio"/> <br/> <br/>
				<input type="SUBMIT" name="addMex" value="Inserisci Messaggio" />
				<input type="SUBMIT" name="print" value="Stampa Nome" />
			</form>
		</div>
		<div style="position:absolute; top:30%; background-color:yellow; border-radius:50px; border:5px solid #0F0; text-align:center;"> <br/> <br/>
			<?php
				if(isset($_REQUEST['print'])){
						echo "Il Tuo Nome: " . $_REQUEST['name'] . "<br/><br/>";
				}
				$ris = getMessages();
				if($ris->num_rows > 0){
					echo "<font size=5> Messaggi Trovati: </font> <br/> <table> ";
						$c = True;
						$fields = $ris -> field_count;
						while($qArrImAMightyPirate = $ris->fetch_assoc()){
							if($c){
								echo "<tr>";
								$k = array_keys($qArrImAMightyPirate);
								for($n=0;$n<$fields;$n++){
									$col1 = dechex(rand(0,16));
									$col2 = dechex(rand(0,16));
									echo "<td><font color='#$col1 0 $col2' size=3>$k[$n]</font><td>";
								}
								echo "</tr>";
							}
							echo "<tr>";
							$val = array_values($qArrImAMightyPirate);
							for($n=0;$n<$fields;$n++){
								echo "<td>$val[$n]<td>";
							}
							$c = False;
							echo "</tr>";
						}
						echo "</table> <br/> <br/>";
						$ris->close();
				?>
					<br/> <font style='color:#F00;font-size:18px;'> Fine Dei Messaggi </font> <br/> <br/><br/> <br/>
				<?php
				}
				else{
			?>
					Non Ci Sono Messaggi. <br/> <br/><br/> <br/>
			<?php
				}
			?>
		</div>
	</body>
</html>