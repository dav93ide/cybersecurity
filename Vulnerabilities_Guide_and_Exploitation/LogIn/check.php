<?php
	session_start();
	include("db_functions.php");
	if(isset($_REQUEST['Registrati'])){
		if($_REQUEST['username'] == null || $_REQUEST['pass'] == null){
				$_SESSION['Error'] = "[+] Per Registrarsi Inserire Username E Password [+]";
				header('location: index.php');
			}
		else{
			$pass = hash("md5", $_REQUEST['pass']);
			insertUserDB($_REQUEST['username'],$pass);
			$reg = True;
		}
	}	
	if(isset($_REQUEST['Log-In']) or isset($reg)){
		if(isset($_REQUEST["m1"])){
			if(loginDB1($_REQUEST['username'], $_REQUEST['pass'])){
				setcookie("cookie",$_SESSION['username'],time()+3600);
				$_SESSION['Message'] = ((isset($reg))
					? $_SESSION['Message'] = "[+] Registrazione E Accesso Effettuati [+] <br/>"
					:"[*] Nome Utente - Pass Trovati [*] <br/>");
				header('location: userpage.php');
			}
			else{
				$_SESSION['Error'] = "[+] Informazioni Inserite Non Valide [+]";
				$_SESSION['name'] = (($_REQUEST['username'] == "") ? "NoName" : $_REQUEST['username']);
				header('location: index.php');
			}
		}
		else{
			if(isset($_REQUEST['m2'])){
				if(loginDB2($_REQUEST['username'], $_REQUEST['pass'])){
					setcookie("cookie",$_SESSION['username'],time()+3600);
					$_SESSION['Message'] = ((isset($reg))
						? $_SESSION['Message'] = "[+] Registrazione E Accesso Effettuati [+] <br/>"
						:"[*] Nome Utente - Pass Trovati [*] <br/>");
					header('location: userpage.php');
				}
				else{
					$_SESSION['Error'] = "[+] Informazioni Inserite Non Valide [+]";
					$_SESSION['name'] = (($_REQUEST['username'] == "") ? "NoName" : $_REQUEST['username']);
					header('location: index.php');
				}
			}
			else{
				$_SESSION['name'] = (($_REQUEST['username'] == "") ? "NoName" : $_REQUEST['username']);
				$_SESSION['Error'] = "[+] Selezionare Un Metodo! [+]";
				header('location: index.php');
			}
		}
	}
	
	if(isset($_REQUEST['changePass'])){
		changePass($_SESSION['username'],$_REQUEST['newPass']);
		$_SESSION['Message'] = " [+] Password Modificata [+] ";
		header('location: userpage.php');
	}
	
	// Log-Out
	if(isset($_REQUEST['logout'])){
		header('location: Byebye.php');
	}
?>